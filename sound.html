<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Waves - Fully Interactive Scroll Lesson</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Define a custom font setup */
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Inter:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a09; /* Stone-950 */
            color: #d6d3d1; /* Stone-300 */
        }
        
        /* Apply custom styles for headings */
        h1, h2, h3 {
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.05em;
        }

        /* Base class for all sections */
        .lesson-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 8rem 1rem;
            position: relative;
            overflow: hidden;
        }
        
        /* Scroll-Reveal animation setup */
        .section-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1.2s ease-out, transform 1.2s ease-out;
            max-width: 1200px;
            width: 100%;
        }

        .section-content.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1c1917; /* Stone-900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #2dd4bf; /* Teal-400 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #20b3a3;
        }

        /* Doppler Simulation Canvas */
        #doppler-canvas {
            border-radius: 0.75rem;
            background-color: #1e293b; /* Slate-800 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 350px;
        }

        /* Particles for Wave Type Demo */
        .particle-dot {
            width: 8px;
            height: 8px;
            background-color: #fcd34d; /* Amber-300 */
            border-radius: 50%;
            transition: all 0.5s ease-in-out;
        }
        .particle-line {
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

    </style>
</head>
<body class="antialiased">

<!-- SECTION 1: TITLE SCREEN -->
<div class="lesson-section bg-gradient-to-b from-stone-950 to-stone-900" id="sec-title">
    <div class="section-content text-center">
        <h1 class="text-7xl sm:text-9xl font-extrabold mb-4">
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-teal-400">
                SOUND PHYSICS
            </span>
        </h1>
        <p class="text-2xl sm:text-3xl text-stone-400 max-w-2xl mx-auto mt-6">
            A fully interactive journey through the science of waves, pitch, and acoustics. Scroll to begin.
        </p>
    </div>
</div>

<!-- SECTION 2: WAVE TYPES (LONGITUDINAL VS TRANSVERSE) -->
<div class="lesson-section bg-stone-900" id="sec-types">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-cyan-400">1. Wave Types: Motion Matters</h2>
        <div class="grid md:grid-cols-2 gap-10">
            <!-- Longitudinal (Sound) -->
            <div class="p-6 bg-stone-800 rounded-xl shadow-lg hover:shadow-cyan-500/20 transition duration-300">
                <h3 class="text-3xl font-semibold mb-4 text-teal-400 flex items-center"><i class="fas fa-arrows-alt-h mr-3"></i> Longitudinal Waves</h3>
                <p class="text-stone-300 mb-6">Particles vibrate **parallel** to the direction of wave travel. This creates areas of high pressure (compression) and low pressure (rarefaction). This is how sound moves.</p>
                <div id="longitudinal-sim" class="h-24 flex items-center justify-center p-4 bg-stone-900 rounded-lg">
                    <div class="particle-line" id="particle-line-a"></div>
                </div>
                <div class="flex justify-center space-x-4 mt-6">
                    <button class="px-6 py-2 bg-teal-500 hover:bg-teal-600 text-stone-900 font-bold rounded-lg transition" onclick="simulateWave('compression')">Compression</button>
                    <button class="px-6 py-2 bg-cyan-500 hover:bg-cyan-600 text-stone-900 font-bold rounded-lg transition" onclick="simulateWave('rarefaction')">Rarefaction</button>
                </div>
            </div>

            <!-- Transverse (Light) -->
            <div class="p-6 bg-stone-800 rounded-xl shadow-lg hover:shadow-teal-500/20 transition duration-300">
                <h3 class="text-3xl font-semibold mb-4 text-teal-400 flex items-center"><i class="fas fa-arrows-alt-v mr-3"></i> Transverse Waves</h3>
                <p class="text-stone-300 mb-6">Particles vibrate **perpendicular** (up and down) to the direction of wave travel. This creates crests and troughs. Light waves are transverse.</p>
                <div id="transverse-sim" class="h-24 flex items-center justify-center p-4 bg-stone-900 rounded-lg">
                    <svg width="100%" height="100" viewBox="0 0 400 100">
                        <path id="transverse-path" d="M0 50 C100 0, 300 100, 400 50" stroke="#fcd34d" stroke-width="3" fill="none" class="transition duration-1000"></path>
                        <circle cx="100" cy="50" r="5" fill="#ef4444" id="transverse-marker">
                            <animateMotion path="M0 0 C0 -50, 200 0, 300 0" dur="4s" repeatCount="indefinite" rotate="auto" keypoints="0;0.25;0.5;0.75;1" keyTimes="0;0.25;0.5;0.75;1"/>
                        </circle>
                    </svg>
                </div>
                <p class="text-center text-sm text-stone-500 mt-6">Note: The red dot moves up/down, but the wave moves left/right.</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 3: WAVE ANATOMY (PITCH & LOUDNESS INTERACTIVE) -->
<div class="lesson-section bg-stone-900" id="sec-anatomy">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-teal-400">2. Anatomy: Pitch and Loudness</h2>
        <div class="grid md:grid-cols-3 gap-10 items-center">
            <!-- Controls -->
            <div class="md:col-span-1 space-y-8 p-6 bg-stone-800 rounded-xl shadow-lg">
                <!-- Amplitude Control -->
                <div class="flex flex-col">
                    <label for="amplitude-slider" class="text-xl font-semibold mb-3 text-cyan-400">
                        LOUDNESS (Amplitude): <span id="amp-value" class="text-2xl font-mono text-fuchsia-400">50%</span>
                    </label>
                    <input type="range" id="amplitude-slider" min="10" max="100" value="50" step="1" class="w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer" oninput="updateWave()">
                    <p class="mt-2 text-sm text-stone-400">If Amplitude is **LOW**, the sound is **QUIET**. If Amplitude is **HIGH**, the sound is **LOUD**.</p>
                </div>
                <!-- Frequency Control -->
                <div class="flex flex-col">
                    <label for="frequency-slider" class="text-xl font-semibold mb-3 text-teal-400">
                        PITCH (Frequency): <span id="freq-value" class="text-2xl font-mono text-fuchsia-400">5 Hz</span>
                    </label>
                    <input type="range" id="frequency-slider" min="1" max="15" value="5" step="1" class="w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer" oninput="updateWave()">
                    <p class="mt-2 text-sm text-stone-400">If Frequency is **LOW**, the pitch is **DEEP**. If Frequency is **HIGH**, the pitch is **HIGH**.</p>
                </div>
            </div>

            <!-- Visualization -->
            <div class="md:col-span-2 p-4 bg-stone-900 rounded-xl shadow-inner h-full min-h-[300px] flex items-center justify-center">
                <svg id="wave-display" width="100%" height="300" viewBox="0 0 600 300" class="w-full">
                    <line x1="0" y1="150" x2="600" y2="150" stroke="#374151" stroke-width="1"/>
                    <path id="wave-line" d="" stroke-width="5" fill="none" class="transition duration-200 stroke-cyan-400" />
                </svg>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 4: THE DECIBEL SCALE (LOGARITHMIC LOUDNESS) -->
<div class="lesson-section bg-stone-900" id="sec-decibels">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-cyan-400">3. Decibel Scale: The Power of 10</h2>
        <div class="grid md:grid-cols-2 gap-10 items-center">
            <div class="p-6 bg-stone-800 rounded-xl shadow-lg">
                <h3 class="text-3xl font-semibold mb-4 text-teal-400">Logarithmic Perception</h3>
                <p class="text-stone-300 mb-4">The Decibel (dB) scale measures sound intensity. It is logarithmic, meaning a small increase in dB represents a huge increase in sound energy.</p>
                <ul class="list-disc list-inside text-stone-400 space-y-1">
                    <li>0 dB: Threshold of human hearing.</li>
                    <li>10 dB: 10x more intense than 0 dB.</li>
                    <li>20 dB: 100x more intense than 0 dB.</li>
                    <li>30 dB: 1,000x more intense than 0 dB.</li>
                </ul>
            </div>
            <div class="p-6 bg-stone-900 rounded-xl shadow-inner">
                <h3 class="text-3xl font-semibold mb-4 text-fuchsia-400">Interactive Decibel Comparison</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center text-lg">
                        <span>Whisper (30 dB)</span>
                        <div class="w-3/4 h-6 bg-stone-700 rounded-full overflow-hidden"><div class="h-full bg-cyan-400 transition-all duration-1000" style="width: 30%;"></div></div>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span>Normal Talk (60 dB)</span>
                        <div class="w-3/4 h-6 bg-stone-700 rounded-full overflow-hidden"><div class="h-full bg-teal-400 transition-all duration-1000" style="width: 60%;"></div></div>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span>Jet Engine (120 dB)</span>
                        <div class="w-3/4 h-6 bg-stone-700 rounded-full overflow-hidden"><div class="h-full bg-red-500 transition-all duration-1000" style="width: 100%;"></div></div>
                    </div>
                </div>
                <p class="mt-4 text-sm text-stone-500">The jump from 60 dB to 120 dB is 1,000,000 times increase in power!</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 5: SPEED OF SOUND (MEDIUM DEPENDENCY) -->
<div class="lesson-section bg-stone-900" id="sec-speed">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-teal-400">4. Speed of Sound: The Medium is the Message</h2>
        <p class="text-center text-xl max-w-3xl mx-auto mb-10 text-stone-300">Sound speed depends on the medium's density and stiffness. Particles closer together transfer vibrations faster.</p>

        <div class="w-full max-w-4xl mx-auto space-y-6" id="speed-chart">
            <div class="flex items-center">
                <div class="w-32 text-right font-bold text-cyan-400">Gas (Air)</div>
                <div class="flex-1 ml-4 h-10 bg-stone-700 rounded-lg overflow-hidden relative">
                    <div class="bar-fill h-full bg-cyan-600/70 transition-all duration-[1500ms] ease-out flex items-center justify-end pr-4 text-sm font-semibold" data-width="10" data-value="343 m/s" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-32 text-right font-bold text-teal-400">Liquid (Water)</div>
                <div class="flex-1 ml-4 h-10 bg-stone-700 rounded-lg overflow-hidden relative">
                    <div class="bar-fill h-full bg-teal-600/70 transition-all duration-[1500ms] ease-out flex items-center justify-end pr-4 text-sm font-semibold" data-width="40" data-value="1,480 m/s" style="width: 0%;"></div>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-32 text-right font-bold text-fuchsia-400">Solid (Steel)</div>
                <div class="flex-1 ml-4 h-10 bg-stone-700 rounded-lg overflow-hidden relative">
                    <div class="bar-fill h-full bg-fuchsia-600/70 transition-all duration-[1500ms] ease-out flex items-center justify-end pr-4 text-sm font-semibold" data-width="95" data-value="5,960 m/s" style="width: 0%;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 6: THE DOPPLER EFFECT (CANVAS SIMULATION) -->
<div class="lesson-section bg-stone-900" id="sec-doppler">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-cyan-400">5. Doppler Effect: Change in Pitch</h2>
        <p class="text-center text-xl max-w-3xl mx-auto mb-10 text-stone-300">The perceived change in frequency when the source or listener is moving. Drag the sound source in the canvas!</p>
        
        <div class="w-full max-w-4xl mx-auto p-4 bg-stone-800 rounded-xl shadow-lg">
            <canvas id="doppler-canvas"></canvas>
            <div class="flex justify-between items-center mt-4 text-lg">
                <span id="doppler-pitch" class="text-teal-400 font-mono">Pitch: Normal</span>
                <span class="text-stone-400">Drag the red dot to move the source!</span>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 7: REFLECTION, ABSORPTION, TRANSMISSION -->
<div class="lesson-section bg-stone-900" id="sec-acoustics">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-teal-400">6. Acoustics: Walls and Waves</h2>
        <div class="grid md:grid-cols-3 gap-8 p-6 bg-stone-800 rounded-xl shadow-lg">
            <h3 class="md:col-span-3 text-3xl font-semibold mb-4 text-fuchsia-400 text-center">Interactive Material Test (If/Then Logic)</h3>
            
            <div class="md:col-span-1 text-center">
                <button class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-stone-900 font-bold rounded-lg transition mb-4" onclick="testMaterial('hard')">Test: Concrete Wall</button>
                <p class="text-sm text-stone-400">Hard, dense materials.</p>
            </div>
            <div class="md:col-span-1 text-center">
                <button class="px-6 py-3 bg-amber-600 hover:bg-amber-700 text-stone-900 font-bold rounded-lg transition mb-4" onclick="testMaterial('soft')">Test: Foam Panel</button>
                <p class="text-sm text-stone-400">Soft, porous materials.</p>
            </div>
            <div class="md:col-span-1 text-center">
                <button class="px-6 py-3 bg-blue-700 hover:bg-blue-800 text-stone-900 font-bold rounded-lg transition mb-4" onclick="testMaterial('thin')">Test: Thin Glass</button>
                <p class="text-sm text-stone-400">Light, flexible materials.</p>
            </div>

            <div class="md:col-span-3 mt-6 p-4 border-t border-stone-700">
                <p class="text-xl font-mono text-center text-stone-200" id="acoustics-result">Click a button to see the outcome...</p>
                <div class="flex justify-around mt-4 text-center">
                    <div class="w-24">Reflection: <span id="reflect-val" class="font-bold text-lg text-cyan-400">0%</span></div>
                    <div class="w-24">Absorption: <span id="absorb-val" class="font-bold text-lg text-teal-400">0%</span></div>
                    <div class="w-24">Transmission: <span id="transmit-val" class="font-bold text-lg text-fuchsia-400">0%</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 8: INTERFERENCE (NOISE CANCELLATION) -->
<div class="lesson-section bg-stone-900" id="sec-interference">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-cyan-400">7. Interference: Wave Addition</h2>
        <p class="text-center text-xl max-w-3xl mx-auto mb-10 text-stone-300">When two waves meet, their amplitudes add up. This is the magic behind noise-cancelling headphones.</p>

        <div class="w-full max-w-4xl mx-auto p-8 bg-stone-800 rounded-xl shadow-xl">
            <h3 class="text-2xl font-semibold mb-6 text-teal-400 text-center">Destructive Interference (Cancellation)</h3>
            <svg width="100%" height="200" viewBox="0 0 400 200" class="mb-4">
                <line x1="0" y1="100" x2="400" y2="100" stroke="#374151" stroke-width="1"/>
                <!-- Original Wave (Fixed) -->
                <path id="int-original" d="M0 100 C100 20, 300 180, 400 100" stroke="#f472b6" stroke-width="4" fill="none"/>
                <!-- Anti-Wave (Toggled) -->
                <path id="int-anti" d="M0 100 C100 180, 300 20, 400 100" stroke="#34d399" stroke-width="4" fill="none" style="opacity: 0; transition: opacity 0.5s;"/>
                <!-- Resultant Wave -->
                <path id="int-result" d="M0 100 C100 20, 300 180, 400 100" stroke="#e5e7eb" stroke-width="5" fill="none" style="transition: d 0.5s;"/>
            </svg>
            <div class="flex justify-center">
                <button class="px-8 py-3 bg-green-500 hover:bg-green-600 text-stone-900 font-bold rounded-lg transition" onclick="toggleInterference(this)">
                    <i class="fas fa-volume-mute mr-2"></i> Activate Cancellation
                </button>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 9: RESONANCE (IF/THEN VIBRATION) -->
<div class="lesson-section bg-stone-900" id="sec-resonance">
    <div class="section-content">
        <h2 class="text-5xl font-bold mb-12 text-center text-teal-400">8. Resonance: Matching Frequencies</h2>
        <div class="grid md:grid-cols-2 gap-10 items-center">
            <div class="p-6 bg-stone-800 rounded-xl shadow-lg">
                <h3 class="text-3xl font-semibold mb-4 text-cyan-400">The Resonance Condition</h3>
                <p class="text-stone-300 mb-4">Resonance occurs when an external force vibrates at the **natural frequency** of an object, causing it to vibrate with high amplitude. If the frequencies **match**, the result is **amplified** energy.</p>
                <div class="flex flex-col space-y-3 mt-6">
                    <label for="force-freq" class="text-lg font-semibold text-stone-300">
                        External Force Frequency (Hz): <span id="force-val" class="font-mono text-fuchsia-400">10 Hz</span>
                    </label>
                    <input type="range" id="force-freq" min="5" max="15" value="10" class="w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer" oninput="checkResonance()">
                    <p class="text-stone-400 text-sm">Target Natural Frequency: **10 Hz**</p>
                </div>
            </div>
            <div class="p-6 bg-stone-900 rounded-xl shadow-inner text-center">
                <div id="vibration-cube" class="w-32 h-32 mx-auto bg-stone-500 rounded-lg flex items-center justify-center text-stone-900 text-3xl font-bold transition duration-500">
                    <i class="fas fa-volume-up"></i>
                </div>
                <p id="resonance-status" class="mt-6 text-xl font-bold text-red-500">Frequency Mismatch (Low Vibration)</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION 10: CONCLUSION & NEXT STEPS -->
<div class="lesson-section bg-gradient-to-t from-stone-950 to-stone-900" id="sec-conclusion" style="min-height: 50vh;">
    <div class="section-content text-center">
        <h2 class="text-6xl sm:text-7xl font-bold mb-6 text-teal-400">You've Completed the Journey!</h2>
        <p class="text-2xl text-stone-300 max-w-4xl mx-auto">
            You have mastered 8 key concepts of sound physics, from the motion of particles to complex phenomena like the Doppler Effect and Noise Cancellation.
        </p>
        <div class="mt-10 p-6 bg-stone-900/50 rounded-xl inline-block">
            <h3 class="text-3xl font-semibold text-cyan-400 mb-3">What's Next?</h3>
            <p class="text-xl text-stone-400">Explore the mathematics behind wave equations or try building a digital equalizer!</p>
        </div>
    </div>
</div>

<!-- --- JAVASCRIPT LOGIC --- -->
<script>
    // --- Global State and Setup ---
    document.addEventListener('DOMContentLoaded', () => {
        // --- 1. SCROLL OBSERVER SETUP (for all sections) ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const content = entry.target.querySelector('.section-content');
                if (content) {
                    if (entry.isIntersecting) {
                        content.classList.add('is-visible');
                        // Trigger section-specific animations/setups
                        if (entry.target.id === 'sec-speed') {
                            animateSpeedChart();
                        }
                    } else {
                        // Optional: Reset animation when scrolling away
                        // content.classList.remove('is-visible');
                    }
                }
            });
        }, {
            threshold: 0.3 // Trigger when 30% of the element is visible
        });

        document.querySelectorAll('.lesson-section').forEach(section => {
            observer.observe(section);
        });

        // Initial calls
        setupParticles(document.getElementById('particle-line-a'), 'longitudinal');
        updateWave();
        setupDoppler();
        checkResonance();
    });

    // --- 2. SECTION 2: WAVE TYPES ---
    function setupParticles(container, type) {
        container.innerHTML = '';
        for (let i = 0; i < 20; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle-dot';
            if (type === 'longitudinal') {
                particle.dataset.index = i;
            }
            container.appendChild(particle);
        }
    }

    function simulateWave(type) {
        const particles = document.querySelectorAll('#particle-line-a .particle-dot');
        particles.forEach((p, index) => {
            p.style.transition = 'all 0.5s ease-in-out';
            p.style.transform = 'translateY(0)'; // Reset vertical motion

            // Simulate compression/rarefaction in the middle 1/3
            if (index > 6 && index < 14) {
                const offset = type === 'compression' ? -6 : 10;
                p.style.margin = `0 ${offset}px`;
                p.style.backgroundColor = type === 'compression' ? '#f87171' : '#4ade80';
            } else {
                p.style.margin = '0 5px';
                p.style.backgroundColor = '#fcd34d';
            }
        });
    }

    // --- 3. SECTION 3: WAVE ANATOMY ---
    function generateSineWave(amplitude, frequency, length, center_y) {
        let path = `M0 ${center_y}`;
        const numPoints = 600;
        
        // Scale values for SVG viewbox (amplitude/2 for visual fit)
        const A = amplitude / 2; 
        const F = frequency * 0.03; // Scale frequency for visual waves per length

        for (let i = 0; i <= numPoints; i++) {
            const x = (i / numPoints) * length;
            // Sine wave formula: y = A * sin(2 * pi * F * x) + center_y
            const y = A * Math.sin(2 * Math.PI * F * x) + center_y;
            path += ` L${x.toFixed(2)} ${y.toFixed(2)}`;
        }
        return path;
    }

    window.updateWave = function() {
        const amplitude = parseInt(document.getElementById('amplitude-slider').value);
        const frequency = parseInt(document.getElementById('frequency-slider').value);
        const wavePath = document.getElementById('wave-line');
        
        document.getElementById('amp-value').textContent = `${amplitude}%`;
        document.getElementById('freq-value').textContent = `${frequency} Hz`;

        // If/Then Logic Feedback
        if (amplitude < 30) { wavePath.style.stroke = '#22d3ee'; } // Cyan
        else if (amplitude < 70) { wavePath.style.stroke = '#6ee7b7'; } // Teal-200
        else { wavePath.style.stroke = '#f472b6'; } // Pink

        const pathData = generateSineWave(amplitude, frequency, 600, 150);
        wavePath.setAttribute('d', pathData);
    }

    // --- 4. SECTION 5: SPEED CHART ---
    function animateSpeedChart() {
        document.querySelectorAll('#speed-chart .bar-fill').forEach(fill => {
            const width = fill.getAttribute('data-width');
            const value = fill.getAttribute('data-value');
            fill.style.width = `${width}%`;
            fill.textContent = value;
        });
    }

    // --- 5. SECTION 6: DOPPLER EFFECT (Canvas) ---
    const canvas = document.getElementById('doppler-canvas');
    const ctx = canvas.getContext('2d');
    let sourceX = canvas.width / 2;
    let sourceY = canvas.height / 2;
    let isDragging = false;
    let waveTimer = 0;
    const waveSpeed = 0.8;
    const waveInterval = 20; // How frequently new circles are drawn
    const waves = [];

    // Ensure canvas is correctly sized for retina and responsive
    function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        sourceX = canvas.width / 4; // Start source on the left
        sourceY = canvas.height / 2;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function setupDoppler() {
        canvas.addEventListener('mousedown', startDrag);
        canvas.addEventListener('mouseup', endDrag);
        canvas.addEventListener('mousemove', drag);
        canvas.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
        canvas.addEventListener('touchend', endDrag);
        canvas.addEventListener('touchmove', (e) => drag(e.touches[0]));
        animateDoppler();
    }

    function startDrag(e) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        if (Math.hypot(x - sourceX, y - sourceY) < 20) {
            isDragging = true;
        }
    }

    function endDrag() {
        isDragging = false;
    }

    function drag(e) {
        if (!isDragging) return;
        const rect = canvas.getBoundingClientRect();
        sourceX = e.clientX - rect.left;
        sourceY = e.clientY - rect.top;
    }

    function drawDoppler() {
        ctx.fillStyle = '#1e293b';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw listener (static)
        const listenerX = canvas.width * 0.75;
        const listenerY = canvas.height / 2;
        ctx.beginPath();
        ctx.arc(listenerX, listenerY, 15, 0, Math.PI * 2);
        ctx.fillStyle = '#fcd34d';
        ctx.fill();
        ctx.fillStyle = '#0f172a';
        ctx.font = '12px Inter';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('L', listenerX, listenerY);

        // Calculate source movement velocity (simple version for visual effect)
        const velocityX = (sourceX - canvas.width / 4) * 0.01;

        // Add new wave fronts
        waveTimer++;
        if (waveTimer % waveInterval === 0) {
            waves.push({ x: sourceX, y: sourceY, radius: 0 });
        }

        // Update and draw waves
        for (let i = waves.length - 1; i >= 0; i--) {
            const wave = waves[i];
            wave.radius += waveSpeed;

            // Draw wave circle
            ctx.beginPath();
            ctx.arc(wave.x, wave.y, wave.radius, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(52, 211, 153, ${1 - wave.radius / 300})`; // Fade out
            ctx.lineWidth = 2;
            ctx.stroke();

            // Remove old waves
            if (wave.radius > 300) {
                waves.splice(i, 1);
            }
        }

        // Draw source (Movable)
        ctx.beginPath();
        ctx.arc(sourceX, sourceY, 15, 0, Math.PI * 2);
        ctx.fillStyle = '#ef4444';
        ctx.fill();
        ctx.fillStyle = '#0f172a';
        ctx.fillText('S', sourceX, sourceY);

        // If/Then Logic for Doppler Pitch
        const distToListener = sourceX - listenerX;
        const dopplerPitch = document.getElementById('doppler-pitch');
        
        if (distToListener < -100) { // Moving towards listener
            dopplerPitch.textContent = 'Pitch: High (Source Approaching)';
            dopplerPitch.classList.remove('text-teal-400');
            dopplerPitch.classList.add('text-red-400');
        } else if (distToListener > 100) { // Moving away from listener
            dopplerPitch.textContent = 'Pitch: Low (Source Receding)';
            dopplerPitch.classList.remove('text-red-400');
            dopplerPitch.classList.add('text-teal-400');
        } else {
             dopplerPitch.textContent = 'Pitch: Normal (Source Passing)';
             dopplerPitch.classList.remove('text-red-400', 'text-teal-400');
             dopplerPitch.classList.add('text-fuchsia-400');
        }
    }

    function animateDoppler() {
        drawDoppler();
        requestAnimationFrame(animateDoppler);
    }


    // --- 6. SECTION 7: ACOUSTICS ---
    window.testMaterial = function(material) {
        const resultEl = document.getElementById('acoustics-result');
        let reflect, absorb, transmit, color, message;

        if (material === 'hard') {
            reflect = 85; absorb = 5; transmit = 10;
            color = 'text-cyan-400';
            message = 'Concrete Wall: HIGH REFLECTION (Echo). Little sound energy is absorbed.';
        } else if (material === 'soft') {
            reflect = 10; absorb = 80; transmit = 10;
            color = 'text-teal-400';
            message = 'Foam Panel: HIGH ABSORPTION. Sound energy is converted to heat.';
        } else if (material === 'thin') {
            reflect = 15; absorb = 5; transmit = 80;
            color = 'text-fuchsia-400';
            message = 'Thin Glass: HIGH TRANSMISSION. Most sound energy passes straight through.';
        }

        // If/Then Logic: Update visuals based on material choice
        document.getElementById('reflect-val').textContent = `${reflect}%`;
        document.getElementById('absorb-val').textContent = `${absorb}%`;
        document.getElementById('transmit-val').textContent = `${transmit}%`;
        
        resultEl.textContent = message;
        resultEl.className = `text-xl font-mono text-center ${color} mt-4`;
    }

    // --- 7. SECTION 8: INTERFERENCE ---
    const intResultPath = document.getElementById('int-result');
    const intAntiPath = document.getElementById('int-anti');
    const pathOriginal = document.getElementById('int-original').getAttribute('d');
    const pathFlat = 'M0 100 L400 100'; // Flat line for cancellation

    window.toggleInterference = function(button) {
        const isCancelled = button.dataset.state === 'cancelled';
        
        if (!isCancelled) {
            // Activate Cancellation (Destructive Interference)
            intAntiPath.style.opacity = 1; // Anti-wave appears
            intResultPath.setAttribute('d', pathFlat); // Result goes flat
            intResultPath.style.stroke = '#a1a1aa'; // Stone-400
            button.textContent = 'Sound Cancelled (Click to Restore)';
            button.classList.remove('bg-green-500');
            button.classList.add('bg-red-500');
            button.dataset.state = 'cancelled';
        } else {
            // Restore Original (Constructive/Original)
            intAntiPath.style.opacity = 0; // Anti-wave disappears
            intResultPath.setAttribute('d', pathOriginal); // Result returns to original wave
            intResultPath.style.stroke = '#e5e7eb'; // Gray-200
            button.textContent = 'Activate Cancellation';
            button.classList.remove('bg-red-500');
            button.classList.add('bg-green-500');
            button.dataset.state = 'active';
        }
    }

    // --- 8. SECTION 9: RESONANCE ---
    const naturalFrequency = 10;
    window.checkResonance = function() {
        const forceFreq = parseInt(document.getElementById('force-freq').value);
        const cube = document.getElementById('vibration-cube');
        const statusEl = document.getElementById('resonance-status');
        
        document.getElementById('force-val').textContent = `${forceFreq} Hz`;

        let vibrationLevel;
        const diff = Math.abs(forceFreq - naturalFrequency);

        if (diff === 0) {
            // Perfect Match
            vibrationLevel = 1.1; // Max scale
            statusEl.textContent = 'PERFECT MATCH! (MAX RESONANCE)';
            statusEl.className = 'mt-6 text-xl font-bold text-red-500 animate-pulse';
            cube.style.transform = `scale(${vibrationLevel}) rotate(${Math.random() * 4 - 2}deg)`;
            cube.style.backgroundColor = '#f87171'; // Red for intensity
        } else if (diff <= 2) {
            // Close Match
            vibrationLevel = 1 + (2 - diff) * 0.05;
            statusEl.textContent = 'Close Match (High Vibration)';
            statusEl.className = 'mt-6 text-xl font-bold text-amber-500';
            cube.style.transform = `scale(${vibrationLevel}) rotate(0deg)`;
            cube.style.backgroundColor = '#fbbf24'; // Amber
        } else {
            // Mismatch
            vibrationLevel = 1.0;
            statusEl.textContent = 'Frequency Mismatch (Low Vibration)';
            statusEl.className = 'mt-6 text-xl font-bold text-cyan-500';
            cube.style.transform = `scale(${vibrationLevel}) rotate(0deg)`;
            cube.style.backgroundColor = '#64748b'; // Slate
        }
        
        // Apply animation effect based on vibration level
        cube.style.transition = `transform ${0.1 + (1 - vibrationLevel) * 0.5}s ease-in-out, background-color 0.5s`;
    }

</script>

</body>
<button id="backBtn" style="
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 999999;
    padding: 12px 24px;
    border-radius: 12px;
    font-family: 'Inter', 'Montserrat', sans-serif;
    font-weight: 600;
    font-size: 16px;
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    background: linear-gradient(45deg, #667EEA, #764BA2, #F093FB, #F5576C);
    background-size: 400% 400%;
    animation: gradient-x 15s ease infinite;
    color: white;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
">
    â¬… Back to Home
</button>

<script>
const btn = document.getElementById("backBtn");

// Add hover effects
btn.onmouseenter = function() {
    this.style.transform = 'translateY(-3px) scale(1.05)';
    this.style.boxShadow = '0 15px 40px rgba(255, 0, 255, 0.3)';
};

btn.onmouseleave = function() {
    this.style.transform = 'translateY(0) scale(1)';
    this.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.2)';
};

btn.onclick = function() {
    this.style.transform = 'scale(0.95)';
    setTimeout(() => {
        window.location.href = "index.html";
    }, 150);
};
</script>

<style>
@keyframes gradient-x {
    0%, 100% {
        background-size: 400% 400%;
        background-position: left center;
    }
    50% {
        background-size: 400% 400%;
        background-position: right center;
    }
}
</style>
</html>
