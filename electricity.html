<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smooth Interactive Electricity Fundamentals Lecture</title>
    <!-- Load Tailwind CSS via CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for the Ohm's Law Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* Base Professional Dark Theme */
        :root {
            --bg-color: #0c1524; 
            --card-bg: #1c2a41;
            --text-color: #e2e8f0;
            --primary-accent: #3b82f6; 
            --secondary-accent: #60a5fa; 
            --gradient-start: #0f1c30;
            --gradient-end: #1c2a41;
            --border-color: #334155;
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        body {
            background: linear-gradient(180deg, var(--gradient-start) 0%, var(--bg-color) 100%);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; 
            scroll-behavior: smooth; /* Enhances overall scroll feeling */
        }
        
        /* Optimization: Reduced movement for faster content reveal and eliminate blank gaps */
        .section-container {
            min-height: 80vh; 
            padding-top: 5rem;
            padding-bottom: 5rem;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .section-container.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 20px var(--shadow-color);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s;
        }

        /* Animation for current flow (moving dots in SVG) */
        @keyframes flow {
            to {
                stroke-dashoffset: 0;
            }
        }
        .electron-path {
            stroke-dasharray: 10 10;
            stroke-dashoffset: 20;
            animation: flow 1s linear infinite;
        }

        /* Charge Animation */
        @keyframes pulse-attract {
            0% { transform: scale(1); box-shadow: 0 0 10px rgba(76, 201, 240, 0.7); }
            50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(76, 201, 240, 1); }
            100% { transform: scale(1); box-shadow: 0 0 10px rgba(76, 201, 240, 0.7); }
        }
        @keyframes pulse-repel {
            0% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 99, 132, 0.7); }
            50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(255, 99, 132, 1); }
            100% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 99, 132, 0.7); }
        }
        .attract-pulse { animation: pulse-attract 1.5s infinite alternate; }
        .repel-pulse { animation: pulse-repel 1.5s infinite alternate; }

        /* Style for the interactive elements */
        .interactive-element {
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        .interactive-element:hover {
            box-shadow: 0 0 15px rgba(96, 165, 250, 0.5);
        }
        .interactive-element:active {
            transform: scale(0.99);
        }
    </style>
</head>
<body>

    <div id="app" class="max-w-4xl mx-auto px-4 sm:px-8">
        
        <!-- Header - Fixed/Sticky -->
        <header class="sticky top-0 z-20 w-full pt-6 pb-2 mb-10 bg-[var(--bg-color)]/95 backdrop-blur-sm border-b border-[var(--border-color)] shadow-xl">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-[var(--secondary-accent)] text-center">
                Electric Dynamics: An Interactive Lecture
            </h1>
        </header>

        <!-- 1. Overview & Introduction -->
        <section id="sec-1" class="section-container">
            <div class="card p-8 rounded-2xl space-y-4">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)]">1. Overview: What is Electricity?</h2>
                <p class="text-lg opacity-80">
                    Electricity is the flow of energy, fundamentally linked to the movement of subatomic particles called **electrons**. It's the engine of our modern world. In this module, we will explore the core concepts that govern all electrical systems.
                </p>
                
                <div class="flex items-center space-x-4 bg-[var(--gradient-start)] p-4 rounded-xl border border-[var(--border-color)]">
                    <span class="text-4xl">⚡</span>
                    <p class="text-sm text-yellow-300">
                        **Key Insight:** All electricity, from lightning to your phone charger, is governed by the same three core principles: **Voltage (V), Current (I), and Resistance (R).**
                    </p>
                </div>
            </div>
        </section>

        <!-- 2. Key Concept: Charge & Polarity (Interactive) -->
        <section id="sec-2" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6 text-center">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)]">2. Key Concept: Electric Charge</h2>
                <p class="text-lg opacity-80 max-w-2xl mx-auto">
                    The simplest unit of electricity is **Charge (Q)**. Try changing the charges below to see the fundamental law of physics: **Coulomb's Law.**
                </p>
                <div class="flex justify-center items-center space-x-12 mt-8">
                    <div id="charge1-container" class="charge-sphere p-3 rounded-full interactive-element" onclick="toggleCharge('charge1', 'charge1-value')">
                        <div id="charge1-value" class="w-20 h-20 rounded-full flex items-center justify-center text-5xl font-extrabold shadow-lg select-none bg-red-600 text-white" data-charge="+">+</div>
                    </div>

                    <div class="text-6xl text-gray-500 font-light">&harr;</div>

                    <div id="charge2-container" class="charge-sphere p-3 rounded-full interactive-element" onclick="toggleCharge('charge2', 'charge2-value')">
                        <div id="charge2-value" class="w-20 h-20 rounded-full flex items-center justify-center text-5xl font-extrabold shadow-lg select-none bg-blue-600 text-white" data-charge="-" onclick="event.stopPropagation();">-</div>
                    </div>
                </div>

                <div class="h-10 mt-4">
                    <p id="chargeResult" class="text-3xl font-bold"></p>
                </div>
                <p class="text-sm text-gray-400">Click on any sphere to flip its charge (Proton: +, Electron: -).</p>
            </div>
        </section>

        <!-- 3. Deep Explanation: V, I, R (Definitions) -->
        <section id="sec-3" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)]">3. The Big Three: V, I, and R (Definitions)</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Voltage -->
                    <div class="p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] hover:border-[var(--secondary-accent)] transition-all">
                        <h3 class="text-xl font-semibold text-yellow-300 mb-2">Voltage (V) - Potential Difference</h3>
                        <p class="text-sm opacity-70">
                            The **driving force** or electrical pressure. It is the energy required to move a charge. <br/>
                            <span class="text-xs text-yellow-400 font-mono mt-1 block">Unit: Volts (V)</span>
                        </p>
                    </div>
                    <!-- Current -->
                    <div class="p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] hover:border-[var(--secondary-accent)] transition-all">
                        <h3 class="text-xl font-semibold text-pink-300 mb-2">Current (I) - Flow Rate</h3>
                        <p class="text-sm opacity-70">
                            The **rate of flow** of electric charge. Measures the number of electrons passing a point per second. <br/>
                            <span class="text-xs text-pink-400 font-mono mt-1 block">Unit: Amperes (A)</span>
                        </p>
                    </div>
                    <!-- Resistance -->
                    <div class="p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] hover:border-[var(--secondary-accent)] transition-all">
                        <h3 class="text-xl font-semibold text-green-300 mb-2">Resistance (R) - Opposition</h3>
                        <p class="text-sm opacity-70">
                            The **opposition** to the flow of electric current, converting energy to heat. <br/>
                            <span class="text-xs text-green-400 font-mono mt-1 block">Unit: Ohms ($\Omega$)</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Visual Diagram: The Circuit (Animated) -->
        <section id="sec-4" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">4. Visualizing Flow: The Basic Circuit</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    A simple closed loop: The Voltage (Battery) pushes current through the load (Resistor). Watch the animated current flow.
                </p>
                <!-- Simple Animated SVG Circuit Diagram -->
                <div class="flex justify-center">
                    <svg width="300" height="200" viewBox="0 0 300 200" fill="none" stroke="var(--text-color)" stroke-width="2" class="mx-auto">
                        <!-- Path of the Circuit -->
                        <path id="circuitPath" d="M 50 20 H 250 V 180 H 50 L 50 120 M 50 80 L 50 20" stroke="var(--border-color)" fill="none"/>
                        <!-- Battery (Source) -->
                        <line x1="50" y1="80" x2="50" y2="100" stroke="var(--primary-accent)" stroke-width="3" />
                        <line x1="50" y1="100" x2="50" y2="120" stroke="var(--secondary-accent)" stroke-width="1.5" />
                        <text x="30" y="100" fill="var(--secondary-accent)" font-size="14">V</text>
                        
                        <!-- Resistor (Load) -->
                        <rect x="230" y="10" width="40" height="20" fill="var(--card-bg)" stroke="#ef4444" stroke-width="2" transform="rotate(90 250 20)" />
                        <text x="250" y="10" fill="#ef4444" font-size="14" text-anchor="middle" transform="rotate(90 250 20)">R</text>

                        <!-- Animated Current Dots (Electrons) -->
                        <circle cx="0" cy="0" r="3" fill="#ffffff" class="electron-path">
                            <animateMotion dur="4s" repeatCount="indefinite" rotate="auto">
                                <mpath href="#circuitPath" />
                            </animateMotion>
                        </circle>
                        <circle cx="0" cy="0" r="3" fill="#ffffff" class="electron-path">
                            <animateMotion dur="4s" repeatCount="indefinite" begin="1s" rotate="auto">
                                <mpath href="#circuitPath" />
                            </animateMotion>
                        </circle>
                        <circle cx="0" cy="0" r="3" fill="#ffffff" class="electron-path">
                            <animateMotion dur="4s" repeatCount="indefinite" begin="2s" rotate="auto">
                                <mpath href="#circuitPath" />
                            </animateMotion>
                        </circle>
                    </svg>
                </div>
            </div>
        </section>

        <!-- 5. Interactive Practice: Ohm's Law (Live Graph) -->
        <section id="sec-5" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">5. Interactive Practice: Ohm's Law ($V = I \times R$)</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    Adjust the sliders below to change Voltage (V) and Resistance (R). See how the calculated Current (I) and the V-I graph slope instantly react.
                </p>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Sliders -->
                    <div class="space-y-6 p-4 rounded-xl bg-[var(--gradient-start)]">
                        <div class="space-y-1">
                            <label class="text-xl font-bold text-yellow-400 block mb-2">Voltage (V)</label>
                            <input type="range" id="ohmVoltage" min="0" max="12" value="6" step="0.5" class="w-full h-2 bg-blue-700 rounded-lg appearance-none cursor-pointer interactive-element">
                            <div class="text-center mt-1 text-2xl font-mono" id="vOutput">6.0 V</div>
                        </div>

                        <div class="space-y-1">
                            <label class="text-xl font-bold text-green-400 block mb-2">Resistance (R)</label>
                            <input type="range" id="ohmResistance" min="1" max="10" value="2" step="0.5" class="w-full h-2 bg-green-700 rounded-lg appearance-none cursor-pointer interactive-element">
                            <div class="text-center mt-1 text-2xl font-mono" id="rOutput">2.0 Ω</div>
                        </div>

                        <div class="border-t pt-4 border-[var(--border-color)]">
                            <p class="text-xl font-bold text-pink-400">Calculated Current (I = V/R)</p>
                            <p class="text-5xl font-extrabold text-white mt-1" id="iOutput">3.0 A</p>
                        </div>
                    </div>

                    <!-- Graph -->
                    <div>
                        <canvas id="ohmChart" class="w-full h-auto card p-4"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Real-Life Application: AC vs DC (Animation) -->
        <section id="sec-6" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">6. Real-Life Application: AC vs. DC Power</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    Homes use Alternating Current (AC); Batteries use Direct Current (DC). Toggle the switch below to visualize the difference in current flow over time.
                </p>
                <div class="flex flex-col items-center">
                    
                    <!-- NEW CONTAINER: Limits size to max-w-xl and enforces 16:9 aspect ratio -->
                    <div class="w-full max-w-xl mx-auto aspect-video"> 
                        <canvas id="waveform-canvas" width="400" height="200" class="w-full h-full card p-4 rounded-xl shadow-inner"></canvas>
                    </div>
                    
                    <div class="flex items-center space-x-6 mt-6 p-3 rounded-full bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element">
                        <span class="font-bold text-red-400">DC</span>
                        <label for="acDcToggle" class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="acDcToggle" class="sr-only peer" checked>
                            <div class="w-14 h-7 bg-red-600 peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                        <span class="font-bold text-blue-400">AC</span>
                    </div>
                    <p id="acDcStatus" class="mt-4 text-xl font-semibold text-blue-400">Mode: Alternating Current (AC)</p>
                </div>
            </div>
        </section>

        <!-- 7. Practice Questions: Series vs Parallel (Click to Reveal) -->
        <section id="sec-7" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">7. Practice: Series vs. Parallel Circuits</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    Test your knowledge of circuit arrangement. Click on the question to reveal the correct answer and explanation.
                </p>

                <div class="space-y-3">
                    <div class="question-block p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element" onclick="toggleAnswer('q1-answer')">
                        <p class="font-semibold text-lg text-yellow-300">Q1: In which circuit type does the same **current** flow through every component?</p>
                        <p id="q1-answer" class="text-sm text-gray-400 mt-2 hidden">
                            <span class="font-bold text-green-400">Answer: Series Circuit.</span> There is only one path for the electrons to flow, so the rate of flow (current) must be the same everywhere.
                        </p>
                    </div>

                    <div class="question-block p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element" onclick="toggleAnswer('q2-answer')">
                        <p class="font-semibold text-lg text-yellow-300">Q2: In which circuit type does the same **voltage** apply across all components?</p>
                        <p id="q2-answer" class="text-sm text-gray-400 mt-2 hidden">
                            <span class="font-bold text-green-400">Answer: Parallel Circuit.</span> Each branch connects directly back to the source, sharing the same potential difference (voltage).
                        </p>
                    </div>

                    <div class="question-block p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element" onclick="toggleAnswer('q3-answer')">
                        <p class="font-semibold text-lg text-yellow-300">Q3: How do you calculate total resistance ($\text{R}_T$) for components in a parallel arrangement?</p>
                        <p id="q3-answer" class="text-sm text-gray-400 mt-2 hidden">
                            <span class="font-bold text-green-400">Answer: Reciprocal Sum.</span> The total resistance is the reciprocal of the sum of the reciprocals: $$1/\text{R}_T = 1/\text{R}_1 + 1/\text{R}_2 + ...$$
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 8. Summary: Power (The Watt) -->
        <section id="sec-8" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">8. Summary: Electrical Power ($P = V \times I$)</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    Power (P) is the rate at which electrical energy is consumed or produced. Use the inputs below to calculate power consumption (Watts).
                </p>
                <div class="max-w-md mx-auto space-y-4 p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)]">
                    <div class="flex space-x-4">
                        <div class="flex-1">
                            <label class="text-sm font-semibold text-blue-400">Voltage (V)</label>
                            <input type="number" id="powerV" value="120" min="1" class="w-full p-2 rounded-lg bg-gray-800 text-white focus:ring-2 focus:ring-blue-400 interactive-element">
                        </div>
                        <div class="flex-1">
                            <label class="text-sm font-semibold text-pink-400">Current (I)</label>
                            <input type="number" id="powerI" value="5" min="0.1" step="0.1" class="w-full p-2 rounded-lg bg-gray-800 text-white focus:ring-2 focus:ring-pink-400 interactive-element">
                        </div>
                    </div>
                    <div class="text-center pt-4 border-t border-[var(--border-color)]">
                        <p class="text-xl text-gray-400 mb-1">Power (P) in Watts (W)</p>
                        <p class="text-5xl font-extrabold text-yellow-300" id="powerOutput">600 W</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 9. Final Notes: Reactive Components (Click to Expand) -->
        <section id="sec-9" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)] text-center">9. Final Notes: Capacitance and Inductance</h2>
                <p class="text-lg opacity-80 text-center max-w-2xl mx-auto">
                    These components store energy and become crucial in AC circuits. Click to understand their key actions.
                </p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element" onclick="toggleAnswer('cap-info')">
                        <h3 class="text-xl font-semibold text-orange-400 mb-2">Capacitor (C)</h3>
                        <p class="text-sm text-gray-400">Stores energy in an **Electric Field**.</p>
                        <p id="cap-info" class="text-xs text-white mt-2 hidden">
                            <span class="font-bold">Key Action:</span> A capacitor resists changes in **Voltage**. It temporarily stores charge.
                        </p>
                    </div>
                    <div class="p-4 rounded-xl bg-[var(--gradient-start)] border border-[var(--border-color)] interactive-element" onclick="toggleAnswer('ind-info')">
                        <h3 class="text-xl font-semibold text-lime-400 mb-2">Inductor (L)</h3>
                        <p class="text-sm text-gray-400">Stores energy in a **Magnetic Field**.</p>
                        <p id="ind-info" class="text-xs text-white mt-2 hidden">
                            <span class="font-bold">Key Action:</span> An inductor resists changes in **Current**. It creates a back-EMF (voltage) to oppose the change.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 10. Final Challenge: What If? (Interactive) -->
        <section id="sec-10" class="section-container">
            <div class="card p-8 rounded-2xl space-y-6 text-center">
                <h2 class="text-3xl font-bold text-[var(--primary-accent)]">10. Final Challenge: What If?</h2>
                <p class="text-lg opacity-80 max-w-2xl mx-auto">
                    Challenge yourself with Ohm's Law in action. Initial state: $V = 20\text{V}$, $R = 5\Omega$, resulting in $I = 4\text{A}$.
                </p>
                
                <div class="bg-[var(--gradient-start)] p-6 rounded-xl border border-[var(--border-color)] max-w-lg mx-auto space-y-4">
                    <div class="text-3xl font-extrabold text-blue-400">I = 4.0 A (Initial State)</div>
                    
                    <button class="w-full p-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold transition-colors interactive-element" onclick="updateChallenge(10, 5)">
                        If Voltage HALVES (20V $\to$ 10V)?
                    </button>
                    
                    <button class="w-full p-3 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white font-bold transition-colors interactive-element" onclick="updateChallenge(20, 10)">
                        If Resistance DOUBLES (5$\Omega$ $\to$ 10$\Omega$)?
                    </button>

                    <button class="w-full p-3 rounded-lg bg-green-600 hover:bg-green-700 text-white font-bold transition-colors interactive-element" onclick="updateChallenge(10, 2.5)">
                        If V halves AND R halves (10V, 2.5$\Omega$)?
                    </button>

                    <div class="text-center pt-4 border-t border-[var(--border-color)] mt-4">
                        <p class="text-xl text-gray-400 mb-1">New Current (I):</p>
                        <p class="text-5xl font-extrabold text-yellow-300" id="challengeOutput">4.0 A</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center text-gray-500 pt-10 pb-16 text-sm">
            End of Interactive Lecture. Scroll back up and interact with the elements!
        </footer>
    </div>

    <script>
        // --- Global State and Utilities ---
        
        let ohmChartInstance = null;
        let acDcAnimationFrameId = null;
        let lastTime = 0; // For high-performance animation loop

        // --- SECTION SCROLL ANIMATION (Intersection Observer) ---
        const sections = document.querySelectorAll('.section-container');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, {
            // Lower threshold (5%) means it triggers much faster, reducing blank space
            threshold: 0.05 
        });

        sections.forEach(section => {
            observer.observe(section);
        });


        // --- SECTION 2: CHARGE INTERACTION ---
        const chargeResult = document.getElementById('chargeResult');
        const charge1Container = document.getElementById('charge1-container');
        const charge2Container = document.getElementById('charge2-container');

        const updateChargeResult = () => {
            const c1 = document.getElementById('charge1-value').getAttribute('data-charge');
            const c2 = document.getElementById('charge2-value').getAttribute('data-charge');
            
            charge1Container.classList.remove('attract-pulse', 'repel-pulse');
            charge2Container.classList.remove('attract-pulse', 'repel-pulse');

            if (c1 === c2) {
                chargeResult.textContent = "Result: REPEL (Like charges)";
                chargeResult.className = "text-3xl font-bold text-red-500";
                charge1Container.classList.add('repel-pulse');
                charge2Container.classList.add('repel-pulse');
            } else {
                chargeResult.textContent = "Result: ATTRACT (Opposite charges)";
                chargeResult.className = "text-3xl font-bold text-blue-400";
                charge1Container.classList.add('attract-pulse');
                charge2Container.classList.add('attract-pulse');
            }
        };

        const toggleCharge = (containerId, valueId) => {
            const element = document.getElementById(valueId);
            const currentCharge = element.getAttribute('data-charge');
            const newCharge = currentCharge === '+' ? '-' : '+';
            
            element.setAttribute('data-charge', newCharge);
            element.textContent = newCharge;
            
            if (newCharge === '+') {
                element.classList.remove('bg-blue-600');
                element.classList.add('bg-red-600');
            } else {
                element.classList.remove('bg-red-600');
                element.classList.add('bg-blue-600');
            }
            updateChargeResult();
        };

        updateChargeResult(); // Initial state


        // --- SECTION 5: OHM'S LAW INTERACTIVE GRAPH ---
        const V_input = document.getElementById('ohmVoltage');
        const R_input = document.getElementById('ohmResistance');
        const V_output = document.getElementById('vOutput');
        const I_output = document.getElementById('iOutput');
        const R_output = document.getElementById('rOutput');

        const initializeOhmChart = () => {
            const ctx = document.getElementById('ohmChart').getContext('2d');
            
            const initialR = parseFloat(R_input.value);
            const dataPoints = [];
            for (let V = 0; V <= 12; V += 0.5) {
                const I = initialR > 0 ? V / initialR : 0;
                dataPoints.push({ x: V, y: I });
            }

            ohmChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Current (I) vs. Voltage (V)',
                        data: dataPoints,
                        borderColor: 'rgb(255, 205, 86)',
                        tension: 0.1,
                        pointRadius: 3,
                        pointBackgroundColor: 'rgb(255, 205, 86)',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 300 },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Ohm’s Law: I vs V (Slope = 1/R)',
                            color: 'var(--text-color)'
                        },
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Voltage (V)', color: 'var(--secondary-accent)' },
                            min: 0, max: 12,
                            ticks: { color: 'var(--text-color)' },
                            grid: { color: 'var(--border-color)' }
                        },
                        y: {
                            title: { display: true, text: 'Current (I) in Amperes', color: 'var(--secondary-accent)' },
                            min: 0, max: 12, 
                            ticks: { color: 'var(--text-color)' },
                            grid: { color: 'var(--border-color)' }
                        }
                    }
                }
            });
        };

        const updateOhmCalculation = () => {
            const V = parseFloat(V_input.value);
            const R = parseFloat(R_input.value);
            const I = R > 0 ? V / R : 0;

            V_output.textContent = `${V.toFixed(1)} V`;
            R_output.textContent = `${R.toFixed(1)} Ω`;
            I_output.textContent = `${I.toFixed(1)} A`;

            // Update Graph
            if (ohmChartInstance) {
                const newR = R;
                const newDataPoints = [];
                // Re-calculate the line slope based on new Resistance (R)
                for (let v = 0; v <= 12; v += 0.5) {
                    const i_calc = newR > 0 ? v / newR : 0;
                    newDataPoints.push({ x: v, y: i_calc });
                }

                // Add the current operating point as a scatter point
                const currentPoint = { x: V, y: I };
                const pointData = [currentPoint];

                ohmChartInstance.data.datasets[0].data = newDataPoints;
                ohmChartInstance.data.datasets[0].label = `R = ${R.toFixed(1)} Ω`;

                if (ohmChartInstance.data.datasets.length < 2) {
                    ohmChartInstance.data.datasets.push({
                        type: 'scatter',
                        label: 'Operating Point (V, I)',
                        data: pointData,
                        backgroundColor: 'rgb(255, 99, 132)',
                        pointRadius: 8,
                        pointStyle: 'circle'
                    });
                } else {
                    ohmChartInstance.data.datasets[1].data = pointData;
                }

                ohmChartInstance.update();
            }
        };

        V_input.addEventListener('input', updateOhmCalculation);
        R_input.addEventListener('input', updateOhmCalculation);

        // --- SECTION 6: AC/DC ANIMATION (Performance Optimized) ---
        const canvas = document.getElementById('waveform-canvas');
        const ctx = canvas.getContext('2d');
        const acDcToggle = document.getElementById('acDcToggle');
        const acDcStatus = document.getElementById('acDcStatus');

        let isAC = true;
        let animationTime = 0; // Use animationTime instead of 'time' to prevent conflict

        const drawWaveform = (currentTime) => {
            if (!canvas.isConnected) {
                cancelAnimationFrame(acDcAnimationFrameId);
                acDcAnimationFrameId = null;
                return;
            }
            
            const deltaTime = (currentTime - lastTime) / 1000; // Calculate delta time in seconds
            lastTime = currentTime;

            // CRITICAL: Read the dimensions imposed by the 16:9 container CSS
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            canvas.width = width;
            canvas.height = height;

            const midY = height / 2;
            ctx.clearRect(0, 0, width, height);

            // Draw Axis
            ctx.strokeStyle = 'var(--border-color)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, midY);
            ctx.lineTo(width, midY);
            ctx.stroke();

            // Draw Waveform
            ctx.beginPath();
            ctx.lineWidth = 4;
            
            if (isAC) {
                ctx.strokeStyle = 'var(--primary-accent)';
                
                for (let x = 0; x < width; x++) {
                    const amplitude = (height / 2) * 0.7;
                    const frequency = 0.05;
                    // Use animationTime for smooth movement independent of refresh rate
                    const y = midY - amplitude * Math.sin(frequency * x + animationTime * 4); 
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                animationTime += deltaTime; // Increment time based on real elapsed time
                acDcStatus.textContent = "Mode: Alternating Current (AC)";
                acDcStatus.className = "mt-4 text-xl font-semibold text-blue-400";
            } else {
                ctx.strokeStyle = '#ef4444'; 
                const dcOffset = 50 * (height / 200); // Scale offset based on canvas height
                ctx.moveTo(0, midY - dcOffset);
                ctx.lineTo(width, midY - dcOffset);
                animationTime = 0; // Stop time movement for DC
                acDcStatus.textContent = "Mode: Direct Current (DC)";
                acDcStatus.className = "mt-4 text-xl font-semibold text-red-400";
            }

            ctx.stroke();
            acDcAnimationFrameId = requestAnimationFrame(drawWaveform);
        };

        const handleAcDcToggle = () => {
            isAC = acDcToggle.checked;
            if (acDcAnimationFrameId) cancelAnimationFrame(acDcAnimationFrameId);
            // Restart with the current time as the reference
            acDcAnimationFrameId = requestAnimationFrame(drawWaveform); 
        };

        acDcToggle.addEventListener('change', handleAcDcToggle);

        // --- SECTION 7 & 9: CLICK TO REVEAL ---
        const toggleAnswer = (id) => {
            const element = document.getElementById(id);
            element.classList.toggle('hidden');
        };

        // --- SECTION 8: POWER CALCULATION ---
        const powerV = document.getElementById('powerV');
        const powerI = document.getElementById('powerI');
        const powerOutput = document.getElementById('powerOutput');

        const calculatePower = () => {
            const V = parseFloat(powerV.value) || 0;
            const I = parseFloat(powerI.value) || 0;
            const P = V * I;
            powerOutput.textContent = P.toFixed(0) + " W";
        };

        powerV.addEventListener('input', calculatePower);
        powerI.addEventListener('input', calculatePower);
        calculatePower();


        // --- SECTION 10: FINAL CHALLENGE ---
        const challengeOutput = document.getElementById('challengeOutput');

        const updateChallenge = (newV, newR) => {
            const I = newV / newR;
            
            // Basic feedback based on current change relative to initial (4.0A)
            if (I < 4.0) {
                challengeOutput.className = "text-5xl font-extrabold text-red-500";
            } else if (I > 4.0) {
                challengeOutput.className = "text-5xl font-extrabold text-green-500";
            } else {
                challengeOutput.className = "text-5xl font-extrabold text-yellow-300";
            }

            challengeOutput.textContent = `${I.toFixed(1)} A`;
        };
        
        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            // Initial Chart.js and calculation setup
            initializeOhmChart();
            updateOhmCalculation();
            
            // Start the AC/DC animation loop
            acDcAnimationFrameId = requestAnimationFrame(drawWaveform);
        });

    </script>
</body>
</html>
